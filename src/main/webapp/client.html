<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="ISO-8859-1">
    <link rel="stylesheet" href="style.css" type="text/css">
    <title>Very important number generator</title>
    <script type="text/javascript">
        // let eventData;
        let re = /login=(.+);*/
        let cookie = document.cookie;
        let websocket;
        // if (!sessionStorage.getItem("reloading")) {
            if (re.exec(cookie) == null) {
                window.location.href = "http://localhost:8080/index.html";
                // sessionStorage.setItem("reloading", false);
            } else {
                let login = re.exec(cookie)[1];
                websocket = new WebSocket(`ws://localhost:8080/ws/${login}`);
                // sessionStorage.setItem("reloading", true);
                // localStorage.setItem("websocket", websocket);
                // console.log("Websocket established. Realoading set to true")
            }
        // } else {
        //     websocket = localStorage.getItem("websocket");
        //     // document.getElementById("dataFromServer").textContent = eventData;
        //     console.log("Reloading...")
        // }

        websocket.onopen = function (e) {
            // sessionStorage.setItem("reloading", true);
            console.log("[open] Connection established");
        };

        websocket.onmessage = function (event) {
            console.log("Message received:");
            console.log(event.data);
            if (event.data != null) {
                // eventData = event.data;
                document.getElementById("dataFromServer").textContent = event.data;
            }
        }

        websocket.onerror = function (error) {
            console.log(`[error]`);
        };

        websocket.onclose = function () {
            console.log("Info: connection closed");
            // sessionStorage.setItem("reloading", false);
        };

        function closeConnection() {
            console.log("close init")
            if (websocket != null) {
                websocket.close(1000, "Logout");
            }
            window.location.href = "http://localhost:8080/logout";
            // sessionStorage.setItem("reloading", false);
            console.log("Logged out")
        }
    </script>
</head>
<body>

<div class="data-from-server" id="dataFromServer"></div>

<br/>

<button class="logout-button" onclick="closeConnection();">Logout</button>

</body>
</html>